---
title: "Section E"
subtitle: "https://dcsuh.github.io/mappingInR/"
author: "Daniel Suh"
date: "11/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(sf)  
library(terra)  
library(tidyverse)  
library(spData)
library(spDataLarge)
library(magrittr)

library(tmap)    # for static and interactive maps
library(leaflet) # for interactive maps
library(ggplot2) # tidyverse data visualization package
```


## Making Maps with R

Time to make some maps. We'll focus on the 'tmap' package here, but there are a number of packages dedicated to making maps. We'll also introduce 'leaflet' and the mapping capabilites of 'ggplot2'. First, we will go over static maps and then move on to dynamic and interactive maps.

## Static Maps

Static maps are the most common result when visualizing spatial data. Base R's plot() can be used for static maps as we've demonstrated throughout the workshop. However, 'tmap' offers more options for aesthetics and follows a similar syntax with ggplot.

## tmap

Like ggplot, tmap follows a 'grammar of graphics' (the gg in ggplot), where input data is separated from the aesthetics. Input data is defined using tm_shape() and aesthetics are layered on using a wide variety of functions such as tm_fill() and tm_dots().

```{r}
# Add fill layer to nz shape
tm_shape(nz) +
  tm_fill() 
# Add border layer to nz shape
tm_shape(nz) +
  tm_borders() 
# Add fill and border layers to nz shape
tm_shape(nz) +
  tm_fill() +
  tm_borders() 
```

Play around with tmap. Type help("tmap-element") into your console for a full list of functions.

## Map objects

A useful feature of tmap is its ability to store objects representing maps. 

```{r}
map_nz <- tm_shape(nz) + tm_polygons()
class(map_nz)
```

Storing maps as map objects is useful for adding aesthetic layers and new spatial objects on top of each other. You can now add layers to 'map_nz' by simply using the + operator. If you add + tm_shape() then you can add another spatial object.

```{r}
map_nz1 = map_nz +
  tm_shape(nz_elev) + tm_raster(alpha = 0.7)
```

```{r}
nz_water = st_union(nz) %>% st_buffer(22200) %>% 
  st_cast(to = "LINESTRING")
map_nz2 = map_nz1 +
  tm_shape(nz_water) + tm_lines()
```

```{r}
map_nz3 = map_nz2 +
  tm_shape(nz_height) + tm_dots()
```

```{r}
tmap_arrange(map_nz1, map_nz2, map_nz3)
```


## Aesthetics

Like ggplot, the default aesthetics of each layer can be changed. Unlike ggplot, tmap does not use the aes() function but layers can accept arguments that are fixed values or variable fields (based on column names). 

Here is an example of fixed values
```{r}
ma1 = tm_shape(nz) + tm_fill(col = "red")
ma2 = tm_shape(nz) + tm_fill(col = "red", alpha = 0.3)
ma3 = tm_shape(nz) + tm_borders(col = "blue")
ma4 = tm_shape(nz) + tm_borders(lwd = 3)
ma5 = tm_shape(nz) + tm_borders(lty = 2)
ma6 = tm_shape(nz) + tm_fill(col = "red", alpha = 0.3) +
  tm_borders(col = "blue", lwd = 3, lty = 2)
tmap_arrange(ma1, ma2, ma3, ma4, ma5, ma6)
```

And here is an example of how you would use values from a variable. The argument will take the character string associated with the column you are interested in.
```{r}
tm_shape(nz) + tm_fill(col = "Land_area")
```

Finally, you can add nicer titles. expression() allows for superscripts

```{r}
legend_title = expression("Area (km"^2*")")
map_nza = tm_shape(nz) +
  tm_fill(col = "Land_area", title = legend_title) + tm_borders()
map_nza
```

## Color settings






